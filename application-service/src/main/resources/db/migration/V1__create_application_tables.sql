-- Create application_status table
CREATE TABLE IF NOT EXISTS hcm.application_status (
    status_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID NOT NULL,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by UUID NOT NULL
);

-- Create application table
CREATE TABLE IF NOT EXISTS hcm.application (
    application_id SERIAL PRIMARY KEY,
    candidate_id UUID NOT NULL,
    requisition_id INTEGER NOT NULL,
    status_id INTEGER NOT NULL,
    applied_date DATE NOT NULL,
    source VARCHAR(100),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID NOT NULL,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by UUID NOT NULL,
    CONSTRAINT fk_application_status FOREIGN KEY (status_id) REFERENCES hcm.application_status(status_id) ON DELETE RESTRICT
);

-- Create indexes
CREATE INDEX IF NOT EXISTS idx_application_candidate_id ON hcm.application(candidate_id);
CREATE INDEX IF NOT EXISTS idx_application_requisition_id ON hcm.application(requisition_id);
CREATE INDEX IF NOT EXISTS idx_application_status_id ON hcm.application(status_id);
CREATE INDEX IF NOT EXISTS idx_application_applied_date ON hcm.application(applied_date);
CREATE INDEX IF NOT EXISTS idx_application_created_at ON hcm.application(created_at);
CREATE INDEX IF NOT EXISTS idx_application_updated_at ON hcm.application(updated_at);

-- Insert default application statuses
INSERT INTO hcm.application_status (name, created_at, created_by, updated_at, updated_by) VALUES
('Applied', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Under Review', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Shortlisted', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Interview Scheduled', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Interviewed', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Reference Check', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Offer Extended', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Hired', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Rejected', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000'),
('Withdrawn', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000', CURRENT_TIMESTAMP, '00000000-0000-0000-0000-000000000000')
ON CONFLICT (name) DO NOTHING; 